# 19讲 为什么我只查一行的语句，也执行这么慢

## 第一类：查询长时间不返回

### 1.等MDL锁（ metadata lock）

复现方案：

![img](https://static001.geekbang.org/resource/image/74/ca/742249a31b83f4858c51bfe106a5daca.png)

手动创建MDL写锁 ：lock table table_name write;

### 2.等flush

![img](https://static001.geekbang.org/resource/image/2b/9c/2bbc77cfdb118b0d9ef3fdd679d0a69c.png)

1.session A 让表始终被使用

2.session B 被 A 阻塞

3.session C 被 B阻塞

效果如下：

![img](https://static001.geekbang.org/resource/image/39/7e/398407014180be4146c2d088fc07357e.png)

### 3.等行锁

![img](https://static001.geekbang.org/resource/image/3e/75/3e68326b967701c59770612183277475.png)

1. session A开启事务，更新 id为1的数据，占有写锁，未提交
2. session B尝试获取共享锁，会获取失败，提示： Lock wait timeout exceeded; try restarting transaction。

效果：

![img](https://static001.geekbang.org/resource/image/3c/8f/3c266e23fc307283aa94923ecbbc738f.png)